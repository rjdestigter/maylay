{
  "id": "room1",
  "name": "Crossroads",
  "width": 320,
  "height": 180,
  "backgroundColor": "#264653",
  "hotspots": [
    {
      "id": "ship_wheel",
      "name": "Ship wheel",
      "description": "A ship's wheel bolted to a tree. Subtle decoration was clearly not the goal.",
      "bounds": {
        "x": 242,
        "y": 24,
        "w": 34,
        "h": 29
      },
      "walkTarget": {
        "x": 259,
        "y": 121
      }
    },
    {
      "id": "door",
      "name": "door",
      "bounds": {
        "x": 232,
        "y": 50,
        "w": 55,
        "h": 62
      },
      "spriteBounds": {
        "x": 219,
        "y": 41,
        "w": 81,
        "h": 93
      },
      "sprite": {
        "defaultImageId": "doorClosed",
        "flagVariants": [
          {
            "flag": "doorOpen",
            "whenTrueImageId": "doorOpen",
            "whenFalseImageId": "doorClosed"
          }
        ]
      },
      "stateFlags": {
        "locked": "doorLocked",
        "open": "doorOpen",
        "broken": "doorBroken",
        "inspected": "doorInspected"
      },
      "states": {
        "locked": {
          "spriteImageId": "doorClosed",
          "dialogue": {
            "LOOK": "The lock is old, stubborn, and very proud of it.",
            "USE": "The lock politely declines all non-key proposals.",
            "OPEN": "Locked. Impressively, theatrically locked."
          }
        },
        "open": {
          "spriteImageId": "doorOpen",
          "dialogue": {
            "LOOK": "The door is open, as if inviting trouble.",
            "TALK": "You thank the open door. It remains humble.",
            "OPEN": "It is already open. No encore needed."
          }
        },
        "broken": {
          "spriteImageId": "doorOpen",
          "dialogue": {
            "LOOK": "The door hangs crooked on one hinge. Subtle it is not.",
            "USE": "You poke the wreckage. It looks offended.",
            "OPEN": "No need. Nature already opened it aggressively."
          }
        },
        "inspected": {
          "dialogue": {
            "LOOK": "You have already audited this door. The report is still 'locked'."
          }
        }
      },
      "walkTarget": {
        "x": 240,
        "y": 117
      }
    },
    {
      "id": "sign",
      "name": "sign",
      "bounds": {
        "x": 33,
        "y": 64,
        "w": 57,
        "h": 32
      },
      "walkTarget": {
        "x": 63,
        "y": 137
      }
    },
    {
      "id": "hermit",
      "name": "Forest hermit",
      "description": "A weathered hermit watches the crossroads with theatrical suspicion.",
      "bounds": {
        "x": 120,
        "y": 53,
        "w": 36,
        "h": 47
      },
      "spriteBounds": {
        "x": 123,
        "y": 56,
        "w": 28,
        "h": 41
      },
      "sprite": {
        "defaultImageId": "hermitPlaceholder"
      },
      "walkTarget": {
        "x": 140,
        "y": 99
      }
    },
    {
      "id": "moonblossom",
      "name": "Moonblossom",
      "description": "Silver-blue petals. Rare, fragrant, and probably plot-relevant.",
      "bounds": {
        "x": 257,
        "y": 132,
        "w": 24,
        "h": 18
      },
      "spriteBounds": {
        "x": 257,
        "y": 130,
        "w": 21,
        "h": 20
      },
      "sprite": {
        "defaultImageId": "moonblossomPlaceholder"
      },
      "walkTarget": {
        "x": 250,
        "y": 144
      }
    },
    {
      "id": "rumbarrel",
      "name": "Rum barrel",
      "bounds": {
        "x": 2,
        "y": 95,
        "w": 32,
        "h": 34
      },
      "walkTarget": {
        "x": 22,
        "y": 137
      }
    }
  ],
  "xstateChart": {
    "id": "room1_interactions",
    "type": "parallel",
    "states": {
      "door": {
        "initial": "locked",
        "states": {
          "locked": {
            "on": {
              "LOOK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "door"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "The lock is old, stubborn, and very proud of it."
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "OPEN": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "door"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "Locked. Impressively, theatrically locked."
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "USE": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "door",
                      "inventoryItemId": "key",
                      "flagsAll": [
                        "keyTaken"
                      ]
                    }
                  },
                  "target": "open",
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "The key turns with a click. The door swings open."
                          ],
                          "setFlags": {
                            "doorOpen": true,
                            "doorLocked": false
                          },
                          "clearSelectedInventory": true
                        }
                      }
                    }
                  ]
                }
              ]
            }
          },
          "open": {
            "on": {
              "LOOK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "door"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "The door is open, as if inviting trouble."
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "OPEN": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "door"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "You step through the open door."
                          ],
                          "roomChangeTo": "room2"
                        }
                      }
                    }
                  ]
                }
              ],
              "USE": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "door",
                      "requireNoInventoryItem": true
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "You step through the open door."
                          ],
                          "roomChangeTo": "room2"
                        }
                      }
                    }
                  ]
                }
              ]
            }
          }
        }
      },
      "moonblossom": {
        "initial": "onPatch",
        "states": {
          "onPatch": {
            "on": {
              "LOOK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "moonblossom"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "A moonblossom. It smells like rain and bad decisions."
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "PICK_UP": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "moonblossom"
                    }
                  },
                  "target": "picked",
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "You carefully pick the moonblossom."
                          ],
                          "addInventoryItem": {
                            "id": "moonblossom",
                            "name": "Moonblossom"
                          },
                          "setFlags": {
                            "moonblossomTaken": true
                          }
                        }
                      }
                    }
                  ]
                }
              ]
            }
          },
          "picked": {}
        }
      },
      "hermit": {
        "initial": "wary",
        "states": {
          "wary": {
            "on": {
              "LOOK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "The hermit looks like he has survived several wars and at least one bad haircut."
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "TALK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit"
                    }
                  },
                  "target": "requestingMoonblossom",
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "Hermit: 'If you seek the castle road, earn it.'",
                            "Hermit: 'Bring me a moonblossom from the purple patch to the east.'"
                          ],
                          "dialogueOptions": [
                            {
                              "id": "hermit_castle",
                              "text": "Ask about the castle road",
                              "result": {
                                "dialogueLines": [
                                  "You: 'Why all this trouble for one road?'",
                                  "Hermit: 'Because roads remember who walks them. The castle road is picky.'"
                                ]
                              }
                            },
                            {
                              "id": "hermit_hat",
                              "text": "Compliment his hat",
                              "result": {
                                "dialogueLines": [
                                  "You: 'Nice hat.'",
                                  "Hermit: 'Finally, a scholar. Still need that moonblossom though.'"
                                ],
                                "dialogueOptions": [
                                  {
                                    "id": "hermit_hat_castle",
                                    "text": "Ask about the castle road",
                                    "result": {
                                      "dialogueLines": [
                                        "You: 'Back to business. The castle road?'",
                                        "Hermit: 'Bring moonblossom. Then we talk destiny.'"
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            {
                              "id": "hermit_bye",
                              "text": "End conversation",
                              "result": {
                                "dialogueLines": [
                                  "You nod and step back from the hermit's personal storm cloud."
                                ]
                              }
                            }
                          ],
                          "setFlags": {
                            "hermitMet": true
                          }
                        }
                      }
                    }
                  ]
                }
              ]
            }
          },
          "requestingMoonblossom": {
            "on": {
              "LOOK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "He taps his staff impatiently, waiting for that flower."
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "TALK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "Hermit: 'Moonblossom first. Epic guidance later.'"
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "USE": [
                {
                  "in": "#room1_interactions.moonblossom.picked",
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit",
                      "inventoryItemId": "moonblossom"
                    }
                  },
                  "target": "helpful",
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "Hermit: 'Ah. Fresh moonblossom. Acceptable hero behavior.'",
                            "Hermit: 'As promised, take this brass key. The oak door adores dramatic entrances.'"
                          ],
                          "addInventoryItem": {
                            "id": "key",
                            "name": "Key"
                          },
                          "removeInventoryItemId": "moonblossom",
                          "clearSelectedInventory": true,
                          "setFlags": {
                            "keyTaken": true,
                            "hermitHelped": true
                          }
                        }
                      }
                    }
                  ]
                }
              ]
            }
          },
          "helpful": {
            "on": {
              "TALK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "Hermit: 'Castle gossip: avoid polite-looking mirrors. They're liars.'"
                          ]
                        }
                      }
                    }
                  ]
                }
              ],
              "LOOK": [
                {
                  "guard": {
                    "type": "matchInteraction",
                    "params": {
                      "hotspotId": "hermit"
                    }
                  },
                  "actions": [
                    {
                      "type": "emitResult",
                      "params": {
                        "result": {
                          "dialogueLines": [
                            "The hermit now nods like you passed an invisible exam."
                          ]
                        }
                      }
                    }
                  ]
                }
              ]
            }
          }
        }
      }
    }
  },
  "walkablePolygon": [
    {
      "x": 71,
      "y": 179
    },
    {
      "x": 57,
      "y": 159
    },
    {
      "x": 44,
      "y": 152
    },
    {
      "x": 24,
      "y": 150
    },
    {
      "x": 20,
      "y": 136
    },
    {
      "x": 32,
      "y": 135
    },
    {
      "x": 53,
      "y": 132
    },
    {
      "x": 72,
      "y": 137
    },
    {
      "x": 96,
      "y": 136
    },
    {
      "x": 106,
      "y": 133
    },
    {
      "x": 113,
      "y": 133
    },
    {
      "x": 119,
      "y": 128
    },
    {
      "x": 122,
      "y": 122
    },
    {
      "x": 107,
      "y": 113
    },
    {
      "x": 100,
      "y": 114
    },
    {
      "x": 83,
      "y": 102
    },
    {
      "x": 86,
      "y": 92
    },
    {
      "x": 101,
      "y": 90
    },
    {
      "x": 125,
      "y": 83
    },
    {
      "x": 132,
      "y": 79
    },
    {
      "x": 124,
      "y": 73
    },
    {
      "x": 130,
      "y": 71
    },
    {
      "x": 139,
      "y": 73
    },
    {
      "x": 146,
      "y": 77
    },
    {
      "x": 141,
      "y": 83
    },
    {
      "x": 131,
      "y": 91
    },
    {
      "x": 128,
      "y": 93
    },
    {
      "x": 140,
      "y": 102
    },
    {
      "x": 171,
      "y": 112
    },
    {
      "x": 195,
      "y": 118
    },
    {
      "x": 228,
      "y": 114
    },
    {
      "x": 262,
      "y": 113
    },
    {
      "x": 284,
      "y": 114
    },
    {
      "x": 302,
      "y": 119
    },
    {
      "x": 308,
      "y": 123
    },
    {
      "x": 283,
      "y": 124
    },
    {
      "x": 268,
      "y": 127
    },
    {
      "x": 263,
      "y": 145
    },
    {
      "x": 245,
      "y": 143
    },
    {
      "x": 230,
      "y": 147
    },
    {
      "x": 210,
      "y": 155
    },
    {
      "x": 195,
      "y": 170
    },
    {
      "x": 196,
      "y": 179
    }
  ],
  "perspective": {
    "farY": 70,
    "nearY": 179,
    "farScale": 0.32,
    "nearScale": 1
  }
}
